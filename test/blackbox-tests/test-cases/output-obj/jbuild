(alias
 ((name all)
  (deps (test.bc
         test.exe
         test.bc${ext_obj}
         test.exe${ext_obj}
         test.bc${ext_dll}
         test${ext_dll}
         prog.bc.exe
         prog.exe))))

(executable
 ((name test)
  (modes ((byte   exe          )
          (native exe          )
          (byte   object       )
          (native object       )
          (byte   shared_object)
          (native shared_object)))))

(rule
 ((targets (prog.exe))
  (deps (stub.c test.exe.o))
  (action (run ${CC} -o ${@} -I ${ocaml_where} -I . test.exe.o stub.c
           ${ocaml-config:native_c_libraries}))))

(rule
 ((targets (prog.bc.exe))
  (deps (stub.c test.bc.o))
  (action (run ${CC} -o ${@} -I ${ocaml_where} -I . test.bc.o stub.c
           ${ocaml-config:bytecomp_c_libraries}))))

(alias
 ((name   runtest)
  (action (run ./prog.exe "Hello, world from manually linked native program"))))

(alias
 ((name   runtest)
  (action (run ./prog.exe "Hello, world from manually linked byte program"))))
